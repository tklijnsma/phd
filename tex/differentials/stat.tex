\subsection{Statistical analysis}
\label{sec:stat}

The measurement of the combined differential cross sections is performed via a simultaneous extended maximum likelihood fit to the diphoton mass, four-lepton mass, and $\msd$ distributions in all the analysis categories of the $\hgg$, $\hzz$, and $\hbb$ channels, respectively.
% 
The differential cross section measurements for the variables considered ($\pth$, $\njets$, $\absy$, and $\ptjet$) are performed individually, i.e. a likelihood is constructed for each variable separately.
% 
Throughout this section the index $i$ will refer to a bin of the variable considered at the reconstructed level, whereas the index $j$ will refer to a bin of the variable at the generator level.
% 
As discussed in Section~\ref{backref}, the binning at generator and reconstructed level may differ depending on the considered variable and decay channel.
% 
The index $k$ will refer to an analysis category, i.e. the mass resolution categories, the final-state lepton configuration, and the double-$\bquark$ tagger output categories for the $\hgg$, $\hzz$, and $\hbb$ channels, respectively.
% 
Finally, the index $m$ will refer to a decay channel.


The number of expected signal events $n^\text{sig}$ is given by:
% 
\begin{linenomath*}
\begin{equation}
n_i^{\text{sig},\,km}(\vec{\Delta\sigma} | \vec{\theta})
= \sum_{j=1}^{n_\text{bins}^\text{gen}}
    \Delta\sigma_j \cdot L(\vec{\theta})
     \cdot \mathcal{B}^{m}
     \cdot M_{ji}^{km}(\vec{\theta})
\,,
\label{eq:nsig}
\end{equation}
\end{linenomath*}
% 
where:
% 
\begin{itemize}
% \item $j$ is a (kinematic) bin index at the generator level;
% 
\item $n_\text{bins}^\text{gen}$ is the number of kinematic bins at the generator level, which is the same for all decay channels;
% 
\item $\vec{\Delta\sigma}$ is the set of differential cross sections at the generator level, and $L$ is the integrated luminosity of the samples used in this analysis;
% 
\item $\mathcal{B}^m$ is the branching fraction of the decay channel $m$;
% 
\item $M_{ji}^{km}$ is the so-called folding matrix, which is the probability for an event in generator-level bin $i$ to be reconstructed in bin $j$ and category $k$, which is determined from Monte Carlo simulation;
% 
note that the corresponding matrix $\vec{M}^{\,km}$ need not be square; the number of reconstructed bins may be smaller than the number of bins at the generator level; and
% 
\item $\vec{\theta}$ is the set of nuisance parameters.
\end{itemize}
% 
The first three terms of the product inside the sum describe the number of events at the generator level in bin $j$.
% 
Via the folding matrix $M$, the contribution of all generator-level bins to the reconstructed-level bin $i$ are taken into account, considering the effects from detector acceptance and bin-to-bin migrations.
% 
The unfolding of bin-to-bin migrations is mathematically an ill-defined problem, and as such it is not a priori clear whether this treatment of bin-to-bin migrations in the likelihood leads to unfolding instabilities.
% 
A study of the need for regularization of detector unfolding is performed in Appendix~\ref{sec:regularization}.
% 
Following the prescription in Ref.~\cite{Hansen:LShape}, we found that no regularization term for the unfolding procedure was needed.


The input analyses considered all perform a cross section measurement based on a fit to a kinematic observable, commonly the invariant mass of the reconstructed decay products.
% 
The kinematic observable, denoted by $\mathcal{O}$, is the diphoton invariant mass, the four-lepton invariant mass, and $\msd$ for the $\hgg$, $\hzz$, and $\hbb$ channels, respectively.
% 
Its signal distribution, $S(\mathcal{O})$, is given by:
% 
\begin{linenomath*}
\begin{align}
\begin{split}
S^{km}_{i}( \mathcal{O} | \vec{\Delta\sigma}, \vec{\theta})
= &
    \sum_{j=1}^{n_\text{bins}^\text{gen}}
        \Delta\sigma_j \cdot L(\vec{\theta}) \cdot \mathcal{B}^{m}
        \cdot M_{ji}^{km}(\vec{\theta})
        \cdot f_{j}^{\text{sig},\,km}( \mathcal{O} | \vec{\theta} )
    % 
    \\ &
    + n^{\text{OOA},\,km}_i
        \cdot f^{\text{OOA},\,km}_i( \mathcal{O} | \vec{\theta} )
\,,
%
\label{eq:Ssig}
\end{split}
\end{align}
\end{linenomath*}
% 
where
% 
\begin{itemize}
% 
\item $f_{j}^{\text{sig},\,km}(\mathcal{O},\vec{\theta})$ is the probability distribution function of signal events in observable $\mathcal{O}$; and
% 
\item $n^{\text{OOA},\,km}_i$ is the number of events reconstructed in bin $i$ originating from outside the fiducial phase space, and $f^{\text{OOA},\,km}( \mathcal{O} | \vec{\theta} )$ is the distribution thereof.
% 
\end{itemize}
% 
The probability distribution functions $f^\text{sig}$ and $f^\text{OOA}$, as well as $n^\text{OOA}$, are determined from Monte Carlo simulations.
% 
Note that the unit of $S$ as defined in Equation~(\ref{eq:Ssig}) is \textit{number of events over the unit of the observable} (usually \GeV), and
% 
\begin{linenomath*}
\begin{equation}
\int_\mathcal{O} S_i^{km}( \mathcal{O} | \vec{\Delta\sigma}, \vec{\theta})
    = n_i^{\text{sig},\,km}(\vec{\Delta\sigma} | \vec{\theta})
      + n^{\text{OOA},\,km}_i
\,.
\end{equation}
\end{linenomath*}
% 
Similarly, the background distribution, $B(\mathcal{O})$, is given by:
% 
\begin{linenomath*}
\begin{equation}
B^{km}_i(\mathcal{O}|\vec{\theta})
= n^{\text{bkg},\,km}_i
    \cdot f^{\text{bkg},\,km}_i(\mathcal{O}|\vec{\theta})
\,,
\end{equation}
\end{linenomath*}
% 
where $n^{\text{bkg},\,km}_i$ is the expected number of background events in reconstructed bin $i$ and $f^{\text{bkg},\,km}_i$ is the distribution thereof, which is determined from Monte Carlo simulation.
% 
As was the case for $S$, $f^\text{bkg}$ is a probability distribution function (with a normalization of $1$), whereas $B$ is here defined as the distribution of background events with respect to the observable (with unit \textit{number of events over the unit of the observable}).
% 
The probability distribution function of finding an event given a value of $\mathcal{O}$, $\text{pdf}(\mathcal{O})$, can then be constructed:
% 
\begin{linenomath*}
\begin{equation}
\text{pdf}_i^{km}(\mathcal{O} | \vec{\Delta\sigma}, \vec{\theta})
= \frac{
        S^{km}_{i}( \mathcal{O} | \vec{\Delta\sigma}, \vec{\theta})
        + B^{km}_i(\mathcal{O}|\vec{\theta})
    }{
        n_i^{\text{sig},\,km}(\vec{\Delta\sigma} | \vec{\theta})
        + n^{\text{OOA},\,km}_i
        + n^{\text{bkg},\,km}_i
    }
\,.
\end{equation}
\end{linenomath*}
% 
Note $\text{pdf}(\mathcal{O})$ has, by construction, a normalization of $1$.


Up to now, $\mathcal{O}$ was considered a continuous variable.
% 
However, due to constraints on available computing time, it is necessary to perform a binned fit of the distribution of $\mathcal{O}$ rather than an unbinned fit, which would require substantially more computing resources.
% 
The index $l$ will refer to the $l^\text{th}$ bin of the binning of $\mathcal{O}$.
% 
Note the definition, and as such also the binning, of $\mathcal{O}$ differs per decay channel.
% 
Using the probability distribution functions for $\mathcal{O}$ and the overall number of expected events $n^\text{sig}$ and $n^\text{bkg}$, an extended likelihood function for a single decay channel $m$ is constructed:
% 
\begin{linenomath*}
\begin{align}
\begin{split}
\mathcal{L}_m(\vec{\Delta\sigma} | \vec{\theta}) =
    \prod_{i=1}^{n_\text{bins}^{\text{reco},\,m}}
    \prod_{k=1}^{n_\text{cat}^m}
    \prod_{l=1}^{n_\mathcal{O}^m}
        &
        \left(
        \text{pdf}_i^{\,km}(\mathcal{O}_l^m | \vec{\Delta\sigma}, \vec{\theta})
        \right)^{ N^{\text{obs},\,km}_{il} }
        % \,
        \\
        & \quad \cdot
        \text{Poisson}\left(
            N^{\text{obs},\,km}_{i}
            \, \left| \,
            n_i^{\text{sig},\,km}(\vec{\Delta\sigma} | \vec{\theta})
            + n^{\text{bkg},\,km}_i(\vec{\theta})
            \right)\right.
\,,
\label{eq:L_per_decaychannel}
\end{split}
\end{align}
\end{linenomath*}
% 
where:
% 
\begin{itemize}
\item $n_\text{bins}^{\text{reco},\,m}$ is the number of reconstructed bins,
$n_\text{cat}^m$ is the number of categories for the decay channel,
and $n_\mathcal{O}^m$ is the number of bins for observable $\mathcal{O}$; and
% 
\item $N^{\text{obs},\,km}_{il}$ is the number of observed events reconstructed in kinematic bin $i$, category $k$ and observable bin $l$.
\end{itemize}
% 
In order to combine the decay channels, the likelihoods for the individual decay channels are multiplied:
% 
\begin{linenomath*}
\begin{equation}
\label{eq:fulllikelihood}
\mathcal{L}(\vec{\Delta\sigma} | \vec{\theta})
= \prod_{m=1}^{n_c} \mathcal{L}_m(\vec{\Delta\sigma} | \vec{\theta})
    \,\cdot\,
    \text{pdf}(\vec{\theta})
\,,
\end{equation}
\end{linenomath*}
% 
where $n_c$ is the number of decay channels included in the combination, $\mathcal{L}_m$ is the likelihood formula from Eq.~(\ref{eq:L_per_decaychannel}) specific to the decay channel $m$, and $\text{pdf}(\vec{\theta})$ is the probability distribution function of the nuisance parameters.
% 
For the individual analyses, the number of categories, invariant mass bins, and even the number of reconstructed bins may differ, although the number of bins at the generator level and their binning need to be aligned between decay channels.
% 
Note that a single common set of differential cross sections and nuisance parameters is fitted to data in all decay channels simultaneously.


The test statistic $q$, which is asymptotically distributed as a $\chi^2$, is defined as~\cite{Cowan:2010js}:
% 
\begin{linenomath*}
\begin{equation}
q(\vec{\Delta\sigma}) = -2 \cdot \ln \left(
    \frac{
        \mathcal{L}
            \left(
            \vec{\Delta\sigma} \left| \hat{\vec{\theta}}_{\vec{\Delta\sigma}}
            \right)\right.
        }{
        \mathcal{L}
            \left(
            \hat{\vec{\Delta\sigma}} \left| \hat{\vec{\theta}}
            \right)\right.
        }
\right)
\,.
\label{eq:TestStatisticQ}
\end{equation}
\end{linenomath*}
% 
The quantities $\hat{\vec{\Delta\sigma}}$ and $\hat{\vec{\theta}}$ are the unconditional maximum likelihood estimates for the parameters $\vec{\Delta\sigma}$ and $\vec{\theta}$, respectively, while $\hat{\vec{\theta}}_{\vec{\Delta\sigma}}$ denotes the maximum likelihood estimate for $\vec{\theta}$ conditional on the values of $\vec{\Delta\sigma}$.


The interpretation of the differential cross sections in terms of Higgs couplings modifiers involves fitting a parametrized prediction in terms of the Higgs coupling modifiers to data.
% 
This is achieved by replacing the differential cross sections $\vec{\Delta\sigma}$ by the parametrizations of theoretical spectra in Equation~(\ref{eq:fulllikelihood}):
% 
\begin{linenomath*}
\begin{equation}
\label{eq:likelihood-interpretation}
    \vec{\Delta\sigma} \; \to \; \vec{\Delta\sigma}( \kappa_\text{a}, \kappa_\text{b} )
    \,,
\end{equation}
\end{linenomath*}
% 
where $\kappa_\text{a}$ and $\kappa_\text{b}$ are the coupling modifiers to be fitted.


